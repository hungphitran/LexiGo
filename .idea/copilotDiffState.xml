<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/GRAMMAR_EXERCISE_BUTTON_UPDATE.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/GRAMMAR_EXERCISE_BUTTON_UPDATE.md" />
              <option name="originalContent" value="# Grammar Lesson Detail Page - Exercise Button Update&#10;&#10;## Date: November 7, 2025&#10;&#10;## Overview&#10;&#10;Updated the grammar lesson detail page to only show a single &quot;Start Exercise&quot; button instead of separate &quot;Start Quiz&quot; and &quot;View Exercises&quot; buttons. The exercise system now supports two types of grammar exercises:&#10;- **fill_blank**: Fill in the blank questions&#10;- **true_false**: True/False questions&#10;&#10;## API Format&#10;&#10;### Grammar Exercises Response&#10;&#10;The API returns exercises in this format:&#10;&#10;#### Fill Blank Exercise&#10;```json&#10;{&#10;  &quot;success&quot;: true,&#10;  &quot;message&quot;: &quot;Fetched exercises&quot;,&#10;  &quot;data&quot;: [&#10;    {&#10;      &quot;_id&quot;: &quot;690abb2671db5de9f4566076&quot;,&#10;      &quot;type&quot;: &quot;fill_blank&quot;,&#10;      &quot;question&quot;: &quot;He ___ to school every day.&quot;,&#10;      &quot;answer&quot;: &quot;goes&quot;,&#10;      &quot;grammar_id&quot;: &quot;690abb2671db5de9f4566074&quot;,&#10;      &quot;level&quot;: &quot;Beginner&quot;&#10;    }&#10;  ]&#10;}&#10;```&#10;&#10;#### True/False Exercise&#10;```json&#10;{&#10;  &quot;success&quot;: true,&#10;  &quot;message&quot;: &quot;Fetched exercises&quot;,&#10;  &quot;data&quot;: [&#10;    {&#10;      &quot;_id&quot;: &quot;690abb2671db5de9f4566077&quot;,&#10;      &quot;type&quot;: &quot;true_false&quot;,&#10;      &quot;question&quot;: &quot;Present Continuous is used for actions happening now.&quot;,&#10;      &quot;answer&quot;: &quot;true&quot;,&#10;      &quot;grammar_id&quot;: &quot;690abb2671db5de9f4566075&quot;,&#10;      &quot;level&quot;: &quot;Intermediate&quot;&#10;    }&#10;  ]&#10;}&#10;```&#10;&#10;## Changes Made&#10;&#10;### 1. Layout File: `activity_grammar_lesson_detail.xml`&#10;&#10;**Before:**&#10;```xml&#10;&lt;LinearLayout&#10;    android:orientation=&quot;horizontal&quot;&gt;&#10;    &lt;Button&#10;        android:id=&quot;@+id/btn_start_quiz&quot;&#10;        android:text=&quot;Start Quiz&quot; /&gt;&#10;    &lt;Button&#10;        android:id=&quot;@+id/btn_load_exercises&quot;&#10;        android:text=&quot;View Exercises&quot; /&gt;&#10;&lt;/LinearLayout&gt;&#10;&#10;&lt;androidx.recyclerview.widget.RecyclerView&#10;    android:id=&quot;@+id/recycler_exercises&quot;&#10;    android:visibility=&quot;gone&quot; /&gt;&#10;```&#10;&#10;**After:**&#10;```xml&#10;&lt;Button&#10;    android:id=&quot;@+id/btn_start_exercise&quot;&#10;    android:layout_width=&quot;match_parent&quot;&#10;    android:layout_height=&quot;wrap_content&quot;&#10;    android:text=&quot;Start Exercise&quot;&#10;    android:backgroundTint=&quot;@color/primary&quot; /&gt;&#10;```&#10;&#10;**Changes:**&#10;- ✅ Removed &quot;Start Quiz&quot; button&#10;- ✅ Removed &quot;View Exercises&quot; button&#10;- ✅ Removed RecyclerView for exercises list&#10;- ✅ Added single &quot;Start Exercise&quot; button&#10;- ✅ Button now takes full width for better visibility&#10;&#10;### 2. Activity: `GrammarLessonDetailActivity.java`&#10;&#10;**Removed:**&#10;- `recyclerExercises` RecyclerView&#10;- `btnLoadExercises` Button&#10;- `btnStartQuiz` Button&#10;- `exerciseAdapter` GrammarExerciseAdapter&#10;- `setupRecyclerView()` method&#10;- `loadExercises()` method&#10;- Unused imports (RecyclerView, LinearLayoutManager, GrammarExerciseAdapter, List, ArrayList)&#10;&#10;**Added:**&#10;- `btnStartExercise` Button - single button to start exercises&#10;&#10;**Updated `initViews()` method:**&#10;```java&#10;private void initViews() {&#10;    // ... existing views ...&#10;    btnStartExercise = findViewById(R.id.btn_start_exercise);&#10;    &#10;    apiService = ApiClient.getInstance(this).getApiService();&#10;    &#10;    btnStartExercise.setOnClickListener(v -&gt; {&#10;        QuizLauncher.launchGrammarQuiz(&#10;            this,&#10;            lessonId,&#10;            lessonTitle != null ? lessonTitle : &quot;Grammar Exercise&quot;,&#10;            lessonLevel&#10;        );&#10;    });&#10;}&#10;```&#10;&#10;**Changes:**&#10;- ✅ Simplified UI - only one button&#10;- ✅ Directly launches quiz/exercises when clicked&#10;- ✅ No intermediate step to load exercises&#10;- ✅ Cleaner code with less complexity&#10;&#10;### 3. Exercise Type Support&#10;&#10;The system already supports both exercise types through:&#10;&#10;#### GrammarExercise Model&#10;```java&#10;@SerializedName(value = &quot;exercise_type&quot;, alternate = {&quot;exerciseType&quot;, &quot;type&quot;})&#10;private String exerciseType; // fill_blank, true_false, etc.&#10;&#10;@SerializedName(value = &quot;correct_answer&quot;, alternate = {&quot;correctAnswer&quot;, &quot;answer&quot;})&#10;private String correctAnswer;&#10;```&#10;&#10;#### QuizActivity - convertGrammarExercises()&#10;```java&#10;// For true_false type, automatically generates True/False options&#10;if (&quot;true_false&quot;.equalsIgnoreCase(exerciseType) &amp;&amp; &#10;    (options == null || options.isEmpty())) {&#10;    options = new ArrayList&lt;&gt;();&#10;    options.add(&quot;True&quot;);&#10;    options.add(&quot;False&quot;);&#10;}&#10;&#10;// Normalizes true/false answers&#10;if (&quot;true_false&quot;.equalsIgnoreCase(exerciseType) &amp;&amp; correctAnswer != null) {&#10;    if (&quot;true&quot;.equalsIgnoreCase(correctAnswer)) {&#10;        correctAnswer = &quot;True&quot;;&#10;    } else if (&quot;false&quot;.equalsIgnoreCase(correctAnswer)) {&#10;        correctAnswer = &quot;False&quot;;&#10;    }&#10;}&#10;```&#10;&#10;## User Flow&#10;&#10;### Simplified Flow&#10;&#10;1. **View Lesson List**&#10;   - User opens Grammar Lessons&#10;   - Sees list of grammar points&#10;&#10;2. **Open Lesson Detail**&#10;   - User taps on a lesson (e.g., &quot;Present Continuous Tense&quot;)&#10;   - System displays:&#10;     - Lesson title&#10;     - Explanation&#10;     - Examples&#10;     - Rules (if available)&#10;     - Tips (if available)&#10;     - **&quot;Start Exercise&quot; button**&#10;&#10;3. **Start Exercise**&#10;   - User taps &quot;Start Exercise&quot; button&#10;   - System calls: `GET /api/v1/lessons/grammar/exercises?grammar_id={id}`&#10;   - Launches QuizActivity with exercises&#10;   - Exercises can be:&#10;     - **Fill Blank**: User sees question with blank to fill&#10;     - **True/False**: User sees question with True/False options&#10;&#10;4. **Complete Exercise**&#10;   - User answers all questions&#10;   - System shows score and review&#10;   - User can review correct/incorrect answers&#10;&#10;## Exercise Type Handling&#10;&#10;### Fill Blank (`fill_blank`)&#10;- **API Format**: `&quot;type&quot;: &quot;fill_blank&quot;`&#10;- **Display**: Shows question with blank (e.g., &quot;He ___ to school&quot;)&#10;- **Answer**: User types or selects answer (e.g., &quot;goes&quot;)&#10;- **Validation**: Compares with `answer` field from API&#10;&#10;### True/False (`true_false`)&#10;- **API Format**: `&quot;type&quot;: &quot;true_false&quot;`&#10;- **Display**: Shows question with True/False options&#10;- **Answer**: User selects True or False&#10;- **Validation**: Normalizes answer (&quot;true&quot; → &quot;True&quot;) and compares&#10;&#10;## Benefits&#10;&#10;✅ **Simpler UI**: One button instead of two&#10;✅ **Better UX**: Direct action - no intermediate loading step&#10;✅ **Cleaner Code**: Removed unused RecyclerView and adapter&#10;✅ **Consistent**: Same flow for all grammar lessons&#10;✅ **Type Support**: Handles both fill_blank and true_false seamlessly&#10;&#10;## Technical Details&#10;&#10;### API Compatibility&#10;&#10;The GrammarExercise model uses field alternates to support multiple API formats:&#10;- `type` → `exercise_type` or `exerciseType`&#10;- `answer` → `correct_answer` or `correctAnswer`&#10;- `grammar_id` → `lesson_id` or `lessonId`&#10;- `level` → `difficulty`&#10;&#10;### QuizActivity Integration&#10;&#10;The QuizActivity automatically:&#10;1. Fetches exercises by `grammar_id`&#10;2. Converts GrammarExercise to QuizQuestion format&#10;3. Generates True/False options for true_false type&#10;4. Normalizes answers for consistent validation&#10;5. Displays questions with appropriate UI&#10;6. Validates answers and shows results&#10;&#10;## Files Modified&#10;&#10;1. **Layout**: `app/src/main/res/layout/activity_grammar_lesson_detail.xml`&#10;   - Replaced two buttons with single &quot;Start Exercise&quot; button&#10;   - Removed RecyclerView for exercises&#10;&#10;2. **Activity**: `app/src/main/java/com/ptithcm/lexigo/activities/GrammarLessonDetailActivity.java`&#10;   - Removed exercise loading and display logic&#10;   - Simplified to single button click handler&#10;   - Removed unused imports and methods&#10;&#10;3. **Quiz Activity**: `app/src/main/java/com/ptithcm/lexigo/activities/QuizActivity.java`&#10;   - Updated `loadGrammarQuiz()` to use `getGrammarExercisesByGrammarId()`&#10;   - Changed from `?lesson=` to `?grammar_id=` query parameter&#10;   - Already handles `fill_blank` type&#10;   - Already handles `true_false` type with auto-generated options&#10;&#10;4. **Model**: `app/src/main/java/com/ptithcm/lexigo/api/models/GrammarExercise.java`&#10;   - Already supports `type` field (mapped from API)&#10;   - Already supports `answer` field (mapped from API)&#10;&#10;5. **API Service**: `app/src/main/java/com/ptithcm/lexigo/api/services/LexiGoApiService.java`&#10;   - Already has `getGrammarExercisesByGrammarId(@Query(&quot;grammar_id&quot;) String grammarId)` endpoint&#10;&#10;## Testing&#10;&#10;### Test Case 1: Fill Blank Exercise&#10;1. Open a grammar lesson&#10;2. Tap &quot;Start Exercise&quot;&#10;3. Verify fill_blank questions display correctly&#10;4. Answer question&#10;5. Verify answer validation works&#10;&#10;### Test Case 2: True/False Exercise&#10;1. Open a grammar lesson&#10;2. Tap &quot;Start Exercise&quot;&#10;3. Verify True/False options appear&#10;4. Select True or False&#10;5. Verify answer validation works&#10;&#10;### Test Case 3: Mixed Exercise Types&#10;1. Open a lesson with both types&#10;2. Verify both fill_blank and true_false questions work&#10;3. Complete all questions&#10;4. Verify final score displays correctly&#10;&#10;## Status: ✅ Complete&#10;&#10;The grammar lesson detail page now:&#10;- Shows only &quot;Start Exercise&quot; button&#10;- Directly launches exercises when clicked&#10;- Supports both fill_blank and true_false exercise types&#10;- Provides a cleaner, simpler user experience&#10;&#10;## Troubleshooting&#10;&#10;### Issue: &quot;Field required&quot; error for grammar_id&#10;&#10;**Error Log:**&#10;```&#10;{&quot;detail&quot;:[{&quot;type&quot;:&quot;missing&quot;,&quot;loc&quot;:[&quot;query&quot;,&quot;grammar_id&quot;],&quot;msg&quot;:&quot;Field required&quot;,&quot;input&quot;:null}]}&#10;```&#10;&#10;**Cause:** &#10;QuizActivity was using the old API endpoint `getGrammarExercises(lessonId)` which sends `lesson` as the query parameter, but the API now requires `grammar_id`.&#10;&#10;**Fix:**&#10;Updated `QuizActivity.java` line 211 to use `getGrammarExercisesByGrammarId(lessonId)`:&#10;&#10;```java&#10;// OLD (incorrect)&#10;Call&lt;ApiResponse&lt;List&lt;GrammarExercise&gt;&gt;&gt; call = apiService.getGrammarExercises(lessonId);&#10;&#10;// NEW (correct)&#10;Call&lt;ApiResponse&lt;List&lt;GrammarExercise&gt;&gt;&gt; call = apiService.getGrammarExercisesByGrammarId(lessonId);&#10;```&#10;&#10;This ensures the API receives the `grammar_id` query parameter as required.&#10;&#10;**Result:** ✅ Fixed - Exercises now load correctly&#10;&#10;" />
              <option name="updatedContent" value="# Grammar Lesson Detail Page - Exercise Button Update&#10;&#10;## Date: November 7, 2025&#10;&#10;## Overview&#10;&#10;Updated the grammar lesson detail page to only show a single &quot;Start Exercise&quot; button instead of separate &quot;Start Quiz&quot; and &quot;View Exercises&quot; buttons. The exercise system now supports two types of grammar exercises:&#10;- **fill_blank**: Fill in the blank questions&#10;- **true_false**: True/False questions&#10;&#10;## API Format&#10;&#10;### Grammar Exercises Response&#10;&#10;The API returns exercises in this format:&#10;&#10;#### Fill Blank Exercise&#10;```json&#10;{&#10;  &quot;success&quot;: true,&#10;  &quot;message&quot;: &quot;Fetched exercises&quot;,&#10;  &quot;data&quot;: [&#10;    {&#10;      &quot;_id&quot;: &quot;690abb2671db5de9f4566076&quot;,&#10;      &quot;type&quot;: &quot;fill_blank&quot;,&#10;      &quot;question&quot;: &quot;He ___ to school every day.&quot;,&#10;      &quot;answer&quot;: &quot;goes&quot;,&#10;      &quot;grammar_id&quot;: &quot;690abb2671db5de9f4566074&quot;,&#10;      &quot;level&quot;: &quot;Beginner&quot;&#10;    }&#10;  ]&#10;}&#10;```&#10;&#10;#### True/False Exercise&#10;```json&#10;{&#10;  &quot;success&quot;: true,&#10;  &quot;message&quot;: &quot;Fetched exercises&quot;,&#10;  &quot;data&quot;: [&#10;    {&#10;      &quot;_id&quot;: &quot;690abb2671db5de9f4566077&quot;,&#10;      &quot;type&quot;: &quot;true_false&quot;,&#10;      &quot;question&quot;: &quot;Present Continuous is used for actions happening now.&quot;,&#10;      &quot;answer&quot;: &quot;true&quot;,&#10;      &quot;grammar_id&quot;: &quot;690abb2671db5de9f4566075&quot;,&#10;      &quot;level&quot;: &quot;Intermediate&quot;&#10;    }&#10;  ]&#10;}&#10;```&#10;&#10;## Changes Made&#10;&#10;### 1. Layout File: `activity_grammar_lesson_detail.xml`&#10;&#10;**Before:**&#10;```xml&#10;&lt;LinearLayout&#10;    android:orientation=&quot;horizontal&quot;&gt;&#10;    &lt;Button&#10;        android:id=&quot;@+id/btn_start_quiz&quot;&#10;        android:text=&quot;Start Quiz&quot; /&gt;&#10;    &lt;Button&#10;        android:id=&quot;@+id/btn_load_exercises&quot;&#10;        android:text=&quot;View Exercises&quot; /&gt;&#10;&lt;/LinearLayout&gt;&#10;&#10;&lt;androidx.recyclerview.widget.RecyclerView&#10;    android:id=&quot;@+id/recycler_exercises&quot;&#10;    android:visibility=&quot;gone&quot; /&gt;&#10;```&#10;&#10;**After:**&#10;```xml&#10;&lt;Button&#10;    android:id=&quot;@+id/btn_start_exercise&quot;&#10;    android:layout_width=&quot;match_parent&quot;&#10;    android:layout_height=&quot;wrap_content&quot;&#10;    android:text=&quot;Start Exercise&quot;&#10;    android:backgroundTint=&quot;@color/primary&quot; /&gt;&#10;```&#10;&#10;**Changes:**&#10;- ✅ Removed &quot;Start Quiz&quot; button&#10;- ✅ Removed &quot;View Exercises&quot; button&#10;- ✅ Removed RecyclerView for exercises list&#10;- ✅ Added single &quot;Start Exercise&quot; button&#10;- ✅ Button now takes full width for better visibility&#10;&#10;### 2. Activity: `GrammarLessonDetailActivity.java`&#10;&#10;**Removed:**&#10;- `recyclerExercises` RecyclerView&#10;- `btnLoadExercises` Button&#10;- `btnStartQuiz` Button&#10;- `exerciseAdapter` GrammarExerciseAdapter&#10;- `setupRecyclerView()` method&#10;- `loadExercises()` method&#10;- Unused imports (RecyclerView, LinearLayoutManager, GrammarExerciseAdapter, List, ArrayList)&#10;&#10;**Added:**&#10;- `btnStartExercise` Button - single button to start exercises&#10;&#10;**Updated `initViews()` method:**&#10;```java&#10;private void initViews() {&#10;    // ... existing views ...&#10;    btnStartExercise = findViewById(R.id.btn_start_exercise);&#10;    &#10;    apiService = ApiClient.getInstance(this).getApiService();&#10;    &#10;    btnStartExercise.setOnClickListener(v -&gt; {&#10;        QuizLauncher.launchGrammarQuiz(&#10;            this,&#10;            lessonId,&#10;            lessonTitle != null ? lessonTitle : &quot;Grammar Exercise&quot;,&#10;            lessonLevel&#10;        );&#10;    });&#10;}&#10;```&#10;&#10;**Changes:**&#10;- ✅ Simplified UI - only one button&#10;- ✅ Directly launches quiz/exercises when clicked&#10;- ✅ No intermediate step to load exercises&#10;- ✅ Cleaner code with less complexity&#10;&#10;### 3. Exercise Type Support&#10;&#10;The system already supports both exercise types through:&#10;&#10;#### GrammarExercise Model&#10;```java&#10;@SerializedName(value = &quot;exercise_type&quot;, alternate = {&quot;exerciseType&quot;, &quot;type&quot;})&#10;private String exerciseType; // fill_blank, true_false, etc.&#10;&#10;@SerializedName(value = &quot;correct_answer&quot;, alternate = {&quot;correctAnswer&quot;, &quot;answer&quot;})&#10;private String correctAnswer;&#10;```&#10;&#10;#### QuizActivity - convertGrammarExercises()&#10;```java&#10;// For true_false type, automatically generates True/False options&#10;if (&quot;true_false&quot;.equalsIgnoreCase(exerciseType) &amp;&amp; &#10;    (options == null || options.isEmpty())) {&#10;    options = new ArrayList&lt;&gt;();&#10;    options.add(&quot;True&quot;);&#10;    options.add(&quot;False&quot;);&#10;}&#10;&#10;// Normalizes true/false answers&#10;if (&quot;true_false&quot;.equalsIgnoreCase(exerciseType) &amp;&amp; correctAnswer != null) {&#10;    if (&quot;true&quot;.equalsIgnoreCase(correctAnswer)) {&#10;        correctAnswer = &quot;True&quot;;&#10;    } else if (&quot;false&quot;.equalsIgnoreCase(correctAnswer)) {&#10;        correctAnswer = &quot;False&quot;;&#10;    }&#10;}&#10;```&#10;&#10;## User Flow&#10;&#10;### Simplified Flow&#10;&#10;1. **View Lesson List**&#10;   - User opens Grammar Lessons&#10;   - Sees list of grammar points&#10;&#10;2. **Open Lesson Detail**&#10;   - User taps on a lesson (e.g., &quot;Present Continuous Tense&quot;)&#10;   - System displays:&#10;     - Lesson title&#10;     - Explanation&#10;     - Examples&#10;     - Rules (if available)&#10;     - Tips (if available)&#10;     - **&quot;Start Exercise&quot; button**&#10;&#10;3. **Start Exercise**&#10;   - User taps &quot;Start Exercise&quot; button&#10;   - System calls: `GET /api/v1/lessons/grammar/exercises?grammar_id={id}`&#10;   - Launches QuizActivity with exercises&#10;   - Exercises can be:&#10;     - **Fill Blank**: User sees question with blank to fill&#10;     - **True/False**: User sees question with True/False options&#10;&#10;4. **Complete Exercise**&#10;   - User answers all questions&#10;   - System shows score and review&#10;   - User can review correct/incorrect answers&#10;&#10;## Exercise Type Handling&#10;&#10;### Fill Blank (`fill_blank`)&#10;- **API Format**: `&quot;type&quot;: &quot;fill_blank&quot;`&#10;- **Display**: Shows question with blank and an **input text field** (e.g., &quot;He ___ to school every day.&quot;)&#10;- **Input**: User types answer in the text field (e.g., &quot;goes&quot;)&#10;- **Validation**: Compares user input with `answer` field from API (case-insensitive)&#10;- **Visual Feedback**:&#10;  - ✅ Correct: Green border on input field&#10;  - ❌ Wrong: Red border with error message showing correct answer&#10;- **Features**:&#10;  - Input field is disabled after answer submission&#10;  - Clear visual feedback with color-coded borders&#10;  - Shows correct answer immediately if wrong&#10;&#10;### True/False (`true_false`)&#10;- **API Format**: `&quot;type&quot;: &quot;true_false&quot;`&#10;- **Display**: Shows question with True/False radio button options&#10;- **Answer**: User selects True or False&#10;- **Validation**: Normalizes answer (&quot;true&quot; → &quot;True&quot;) and compares&#10;- **Visual Feedback**:&#10;  - ✅ Correct: Green text color on selected answer&#10;  - ❌ Wrong: Red text on selected answer, green text on correct answer&#10;&#10;## Benefits&#10;&#10;✅ **Simpler UI**: One button instead of two&#10;✅ **Better UX**: Direct action - no intermediate loading step&#10;✅ **Cleaner Code**: Removed unused RecyclerView and adapter&#10;✅ **Consistent**: Same flow for all grammar lessons&#10;✅ **Type Support**: Handles both fill_blank and true_false seamlessly&#10;&#10;## Technical Details&#10;&#10;### API Compatibility&#10;&#10;The GrammarExercise model uses field alternates to support multiple API formats:&#10;- `type` → `exercise_type` or `exerciseType`&#10;- `answer` → `correct_answer` or `correctAnswer`&#10;- `grammar_id` → `lesson_id` or `lessonId`&#10;- `level` → `difficulty`&#10;&#10;### QuizActivity Integration&#10;&#10;The QuizActivity automatically:&#10;1. Fetches exercises by `grammar_id`&#10;2. Converts GrammarExercise to QuizQuestion format&#10;3. Detects exercise type and shows appropriate UI:&#10;   - **fill_blank**: Shows `TextInputEditText` for user input&#10;   - **true_false**: Generates True/False radio button options&#10;   - **multiple_choice**: Shows radio buttons with provided options&#10;4. Normalizes answers for consistent validation&#10;5. Provides visual feedback based on exercise type&#10;6. Validates answers and shows results&#10;&#10;### Fill Blank Implementation&#10;&#10;**Layout (`activity_quiz.xml`):**&#10;```xml&#10;&lt;com.google.android.material.textfield.TextInputLayout&#10;    android:id=&quot;@+id/input_layout_answer&quot;&#10;    android:layout_width=&quot;match_parent&quot;&#10;    android:layout_height=&quot;wrap_content&quot;&#10;    android:hint=&quot;Type your answer here&quot;&#10;    android:visibility=&quot;gone&quot;&#10;    app:boxBackgroundMode=&quot;outline&quot;&#10;    app:boxStrokeColor=&quot;@color/primary&quot;&gt;&#10;&#10;    &lt;com.google.android.material.textfield.TextInputEditText&#10;        android:id=&quot;@+id/et_answer&quot;&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;wrap_content&quot;&#10;        android:inputType=&quot;text&quot;&#10;        android:maxLines=&quot;3&quot;/&gt;&#10;&#10;&lt;/com.google.android.material.textfield.TextInputLayout&gt;&#10;```&#10;&#10;**Logic (`QuizActivity.java`):**&#10;```java&#10;// Display question&#10;if (&quot;fill_blank&quot;.equalsIgnoreCase(questionType)) {&#10;    inputLayoutAnswer.setVisibility(View.VISIBLE);&#10;    radioGroup.setVisibility(View.GONE);&#10;} else {&#10;    inputLayoutAnswer.setVisibility(View.GONE);&#10;    radioGroup.setVisibility(View.VISIBLE);&#10;}&#10;&#10;// Check answer&#10;if (isFillBlank) {&#10;    selectedAnswer = etAnswer.getText().toString().trim();&#10;    isCorrect = selectedAnswer.equalsIgnoreCase(correctAnswer); // Case-insensitive&#10;    &#10;    // Visual feedback&#10;    if (isCorrect) {&#10;        inputLayoutAnswer.setBoxStrokeColor(green); // Success&#10;    } else {&#10;        inputLayoutAnswer.setBoxStrokeColor(red); // Error&#10;        inputLayoutAnswer.setError(&quot;Correct answer: &quot; + correctAnswer);&#10;    }&#10;}&#10;```&#10;&#10;## Files Modified&#10;&#10;1. **Layout**: `app/src/main/res/layout/activity_grammar_lesson_detail.xml`&#10;   - Replaced two buttons with single &quot;Start Exercise&quot; button&#10;   - Removed RecyclerView for exercises&#10;&#10;2. **Quiz Layout**: `app/src/main/res/layout/activity_quiz.xml`&#10;   - Added `TextInputLayout` and `TextInputEditText` for fill_blank type&#10;   - Input field shown/hidden based on exercise type&#10;&#10;3. **Activity**: `app/src/main/java/com/ptithcm/lexigo/activities/GrammarLessonDetailActivity.java`&#10;   - Removed exercise loading and display logic&#10;   - Simplified to single button click handler&#10;   - Removed unused imports and methods&#10;&#10;4. **Quiz Activity**: `app/src/main/java/com/ptithcm/lexigo/activities/QuizActivity.java`&#10;   - Updated `loadGrammarQuiz()` to use `getGrammarExercisesByGrammarId()`&#10;   - Changed from `?lesson=` to `?grammar_id=` query parameter&#10;   - Added `TextInputLayout` and `TextInputEditText` fields&#10;   - Updated `displayQuestion()` to show input field for fill_blank type&#10;   - Updated `checkAnswer()` to handle both EditText and RadioButton inputs&#10;   - Added case-insensitive validation for fill_blank&#10;   - Added visual feedback (green/red borders) for input field&#10;   - Disables input controls after answer submission&#10;&#10;5. **Model**: `app/src/main/java/com/ptithcm/lexigo/api/models/GrammarExercise.java`&#10;   - Already supports `type` field (mapped from API)&#10;   - Already supports `answer` field (mapped from API)&#10;&#10;6. **API Service**: `app/src/main/java/com/ptithcm/lexigo/api/services/LexiGoApiService.java`&#10;   - Already has `getGrammarExercisesByGrammarId(@Query(&quot;grammar_id&quot;) String grammarId)` endpoint&#10;&#10;## Testing&#10;&#10;### Test Case 1: Fill Blank Exercise&#10;1. Open a grammar lesson&#10;2. Tap &quot;Start Exercise&quot;&#10;3. Verify fill_blank questions display correctly&#10;4. Answer question&#10;5. Verify answer validation works&#10;&#10;### Test Case 2: True/False Exercise&#10;1. Open a grammar lesson&#10;2. Tap &quot;Start Exercise&quot;&#10;3. Verify True/False options appear&#10;4. Select True or False&#10;5. Verify answer validation works&#10;&#10;### Test Case 3: Mixed Exercise Types&#10;1. Open a lesson with both types&#10;2. Verify both fill_blank and true_false questions work&#10;3. Complete all questions&#10;4. Verify final score displays correctly&#10;&#10;## Status: ✅ Complete&#10;&#10;The grammar lesson detail page now:&#10;- Shows only &quot;Start Exercise&quot; button&#10;- Directly launches exercises when clicked&#10;- Supports both fill_blank and true_false exercise types&#10;- Provides a cleaner, simpler user experience&#10;&#10;## Troubleshooting&#10;&#10;### Issue: &quot;Field required&quot; error for grammar_id&#10;&#10;**Error Log:**&#10;```&#10;{&quot;detail&quot;:[{&quot;type&quot;:&quot;missing&quot;,&quot;loc&quot;:[&quot;query&quot;,&quot;grammar_id&quot;],&quot;msg&quot;:&quot;Field required&quot;,&quot;input&quot;:null}]}&#10;```&#10;&#10;**Cause:** &#10;QuizActivity was using the old API endpoint `getGrammarExercises(lessonId)` which sends `lesson` as the query parameter, but the API now requires `grammar_id`.&#10;&#10;**Fix:**&#10;Updated `QuizActivity.java` line 211 to use `getGrammarExercisesByGrammarId(lessonId)`:&#10;&#10;```java&#10;// OLD (incorrect)&#10;Call&lt;ApiResponse&lt;List&lt;GrammarExercise&gt;&gt;&gt; call = apiService.getGrammarExercises(lessonId);&#10;&#10;// NEW (correct)&#10;Call&lt;ApiResponse&lt;List&lt;GrammarExercise&gt;&gt;&gt; call = apiService.getGrammarExercisesByGrammarId(lessonId);&#10;```&#10;&#10;This ensures the API receives the `grammar_id` query parameter as required.&#10;&#10;**Result:** ✅ Fixed - Exercises now load correctly&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/ptithcm/lexigo/activities/QuizActivity.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/ptithcm/lexigo/activities/QuizActivity.java" />
              <option name="originalContent" value="package com.ptithcm.lexigo.activities;&#10;&#10;import android.content.Intent;&#10;import android.graphics.Color;&#10;import android.os.Bundle;&#10;import android.util.Log;&#10;import android.view.View;&#10;import android.widget.Button;&#10;import android.widget.LinearLayout;&#10;import android.widget.ProgressBar;&#10;import android.widget.RadioButton;&#10;import android.widget.RadioGroup;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;&#10;import androidx.appcompat.app.AlertDialog;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import androidx.cardview.widget.CardView;&#10;&#10;import com.ptithcm.lexigo.R;&#10;import com.ptithcm.lexigo.api.ApiClient;&#10;import com.ptithcm.lexigo.api.models.GrammarExercise;&#10;import com.ptithcm.lexigo.api.models.VocabQuiz;&#10;import com.ptithcm.lexigo.api.responses.ApiResponse;&#10;import com.ptithcm.lexigo.api.services.LexiGoApiService;&#10;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;/**&#10; * Unified Quiz Activity for both Vocabulary and Grammar quizzes&#10; * Supports multiple question types: multiple_choice, fill_in_blank, etc.&#10; */&#10;public class QuizActivity extends AppCompatActivity {&#10;    private static final String TAG = &quot;QuizActivity&quot;;&#10;&#10;    // Intent extras constants&#10;    public static final String EXTRA_QUIZ_TYPE = &quot;quiz_type&quot;;&#10;    public static final String EXTRA_TOPIC_ID = &quot;topic_id&quot;;&#10;    public static final String EXTRA_LESSON_ID = &quot;lesson_id&quot;;&#10;    public static final String EXTRA_LEVEL = &quot;level&quot;;&#10;    public static final String EXTRA_TITLE = &quot;title&quot;;&#10;&#10;    public static final String QUIZ_TYPE_VOCAB = &quot;vocab&quot;;&#10;    public static final String QUIZ_TYPE_GRAMMAR = &quot;grammar&quot;;&#10;&#10;    // UI Components&#10;    private CardView cardProgress;&#10;    private TextView tvQuestionNumber, tvScore, tvTimer;&#10;    private ProgressBar horizontalProgress, loadingProgress;&#10;    private CardView cardQuestion;&#10;    private TextView tvQuestion, tvQuestionType;&#10;    private RadioGroup radioGroup;&#10;    private CardView cardExplanation;&#10;    private TextView tvExplanation;&#10;    private LinearLayout buttonLayout;&#10;    private Button btnSubmit, btnNext, btnFinish;&#10;&#10;    // Data&#10;    private LexiGoApiService apiService;&#10;    private List&lt;QuizQuestion&gt; quizQuestions;&#10;    private int currentQuestionIndex = 0;&#10;    private int score = 0;&#10;    private int correctAnswers = 0;&#10;&#10;    private String quizType;&#10;    private String topicId;&#10;    private String lessonId;&#10;    private String level;&#10;    private String quizTitle;&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        setContentView(R.layout.activity_quiz);&#10;&#10;        // Get data from intent&#10;        Intent intent = getIntent();&#10;        if (intent != null) {&#10;            quizType = intent.getStringExtra(EXTRA_QUIZ_TYPE);&#10;            topicId = intent.getStringExtra(EXTRA_TOPIC_ID);&#10;            lessonId = intent.getStringExtra(EXTRA_LESSON_ID);&#10;            level = intent.getStringExtra(EXTRA_LEVEL);&#10;            quizTitle = intent.getStringExtra(EXTRA_TITLE);&#10;        }&#10;&#10;        // Set title&#10;        if (getSupportActionBar() != null) {&#10;            getSupportActionBar().setTitle(quizTitle != null ? quizTitle + &quot; - Quiz&quot; : &quot;Quiz&quot;);&#10;            getSupportActionBar().setDisplayHomeAsUpEnabled(true);&#10;        }&#10;&#10;        initViews();&#10;        loadQuiz();&#10;    }&#10;&#10;    private void initViews() {&#10;        // Progress card&#10;        cardProgress = findViewById(R.id.card_progress);&#10;        tvQuestionNumber = findViewById(R.id.tv_question_number);&#10;        tvScore = findViewById(R.id.tv_score);&#10;        tvTimer = findViewById(R.id.tv_timer);&#10;        horizontalProgress = findViewById(R.id.horizontal_progress);&#10;&#10;        // Loading&#10;        loadingProgress = findViewById(R.id.loading_progress);&#10;&#10;        // Question card&#10;        cardQuestion = findViewById(R.id.card_question);&#10;        tvQuestion = findViewById(R.id.tv_question);&#10;        tvQuestionType = findViewById(R.id.tv_question_type);&#10;        radioGroup = findViewById(R.id.radio_group);&#10;&#10;        // Explanation card&#10;        cardExplanation = findViewById(R.id.card_explanation);&#10;        tvExplanation = findViewById(R.id.tv_explanation);&#10;&#10;        // Buttons&#10;        buttonLayout = findViewById(R.id.button_layout);&#10;        btnSubmit = findViewById(R.id.btn_submit);&#10;        btnNext = findViewById(R.id.btn_next);&#10;        btnFinish = findViewById(R.id.btn_finish);&#10;&#10;        // Initialize API service&#10;        apiService = ApiClient.getInstance(this).getApiService();&#10;&#10;        // Set click listeners&#10;        btnSubmit.setOnClickListener(v -&gt; checkAnswer());&#10;        btnNext.setOnClickListener(v -&gt; loadNextQuestion());&#10;        btnFinish.setOnClickListener(v -&gt; showFinalResults());&#10;&#10;        // Initially hide explanation&#10;        cardExplanation.setVisibility(View.GONE);&#10;    }&#10;&#10;    private void loadQuiz() {&#10;        if (quizType == null) {&#10;            showError(&quot;Quiz type is required&quot;);&#10;            finish();&#10;            return;&#10;        }&#10;&#10;        loadingProgress.setVisibility(View.VISIBLE);&#10;        cardQuestion.setVisibility(View.GONE);&#10;&#10;        if (QUIZ_TYPE_VOCAB.equals(quizType)) {&#10;            loadVocabQuiz();&#10;        } else if (QUIZ_TYPE_GRAMMAR.equals(quizType)) {&#10;            loadGrammarQuiz();&#10;        } else {&#10;            showError(&quot;Invalid quiz type&quot;);&#10;            finish();&#10;        }&#10;    }&#10;&#10;    private void loadVocabQuiz() {&#10;        if (topicId == null) {&#10;            showError(&quot;Topic ID is required for vocab quiz&quot;);&#10;            finish();&#10;            return;&#10;        }&#10;&#10;        Call&lt;ApiResponse&lt;List&lt;VocabQuiz&gt;&gt;&gt; call = apiService.getVocabQuizzes(topicId, level);&#10;        call.enqueue(new Callback&lt;ApiResponse&lt;List&lt;VocabQuiz&gt;&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;ApiResponse&lt;List&lt;VocabQuiz&gt;&gt;&gt; call,&#10;                                 Response&lt;ApiResponse&lt;List&lt;VocabQuiz&gt;&gt;&gt; response) {&#10;                loadingProgress.setVisibility(View.GONE);&#10;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    ApiResponse&lt;List&lt;VocabQuiz&gt;&gt; apiResponse = response.body();&#10;                    if (apiResponse.isSuccess() &amp;&amp; apiResponse.getData() != null) {&#10;                        List&lt;VocabQuiz&gt; vocabQuizzes = apiResponse.getData();&#10;                        Log.d(TAG, &quot;Received &quot; + vocabQuizzes.size() + &quot; vocab quizzes&quot;);&#10;                        quizQuestions = convertVocabQuizzes(vocabQuizzes);&#10;&#10;                        if (!quizQuestions.isEmpty()) {&#10;                            cardQuestion.setVisibility(View.VISIBLE);&#10;                            displayQuestion();&#10;                        } else {&#10;                            showError(&quot;No quiz questions available&quot;);&#10;                        }&#10;                    } else {&#10;                        showError(&quot;Failed to load quiz: &quot; + apiResponse.getMessage());&#10;                    }&#10;                } else {&#10;                    showError(&quot;Failed to load quiz&quot;);&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;ApiResponse&lt;List&lt;VocabQuiz&gt;&gt;&gt; call, Throwable t) {&#10;                loadingProgress.setVisibility(View.GONE);&#10;                Log.e(TAG, &quot;Error loading vocab quiz&quot;, t);&#10;                showError(&quot;Network error: &quot; + t.getMessage());&#10;            }&#10;        });&#10;    }&#10;&#10;    private void loadGrammarQuiz() {&#10;        if (lessonId == null) {&#10;            showError(&quot;Lesson ID is required for grammar quiz&quot;);&#10;            finish();&#10;            return;&#10;        }&#10;&#10;        Call&lt;ApiResponse&lt;List&lt;GrammarExercise&gt;&gt;&gt; call = apiService.getGrammarExercisesByGrammarId(lessonId);&#10;        call.enqueue(new Callback&lt;ApiResponse&lt;List&lt;GrammarExercise&gt;&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;ApiResponse&lt;List&lt;GrammarExercise&gt;&gt;&gt; call,&#10;                                 Response&lt;ApiResponse&lt;List&lt;GrammarExercise&gt;&gt;&gt; response) {&#10;                loadingProgress.setVisibility(View.GONE);&#10;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    ApiResponse&lt;List&lt;GrammarExercise&gt;&gt; apiResponse = response.body();&#10;                    if (apiResponse.isSuccess() &amp;&amp; apiResponse.getData() != null) {&#10;                        List&lt;GrammarExercise&gt; grammarExercises = apiResponse.getData();&#10;                        quizQuestions = convertGrammarExercises(grammarExercises);&#10;&#10;                        if (!quizQuestions.isEmpty()) {&#10;                            cardQuestion.setVisibility(View.VISIBLE);&#10;                            displayQuestion();&#10;                        } else {&#10;                            showError(&quot;No exercises available&quot;);&#10;                        }&#10;                    } else {&#10;                        showError(&quot;Failed to load exercises: &quot; + apiResponse.getMessage());&#10;                    }&#10;                } else {&#10;                    showError(&quot;Failed to load exercises&quot;);&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;ApiResponse&lt;List&lt;GrammarExercise&gt;&gt;&gt; call, Throwable t) {&#10;                loadingProgress.setVisibility(View.GONE);&#10;                Log.e(TAG, &quot;Error loading grammar exercises&quot;, t);&#10;                showError(&quot;Network error: &quot; + t.getMessage());&#10;            }&#10;        });&#10;    }&#10;&#10;    private List&lt;QuizQuestion&gt; convertVocabQuizzes(List&lt;VocabQuiz&gt; vocabQuizzes) {&#10;        List&lt;QuizQuestion&gt; questions = new ArrayList&lt;&gt;();&#10;        for (int i = 0; i &lt; vocabQuizzes.size(); i++) {&#10;            VocabQuiz quiz = vocabQuizzes.get(i);&#10;            Log.d(TAG, &quot;=== VocabQuiz #&quot; + (i + 1) + &quot; ===&quot;);&#10;            Log.d(TAG, &quot;Question: &quot; + quiz.getQuestion());&#10;            Log.d(TAG, &quot;QuestionType: &quot; + quiz.getQuestionType());&#10;            Log.d(TAG, &quot;Correct Answer: &quot; + quiz.getCorrectAnswer());&#10;            Log.d(TAG, &quot;Answer Index: &quot; + quiz.getAnswerIndex());&#10;            Log.d(TAG, &quot;Options: &quot; + quiz.getOptions());&#10;            Log.d(TAG, &quot;Explanation: &quot; + quiz.getExplanation());&#10;&#10;            QuizQuestion question = new QuizQuestion();&#10;            question.setQuestion(quiz.getQuestion());&#10;            question.setQuestionType(quiz.getQuestionType());&#10;            question.setOptions(quiz.getOptions());&#10;&#10;            // Determine correct answer - use correctAnswer if available, otherwise use answerIndex&#10;            String correctAnswer = quiz.getCorrectAnswer();&#10;            if ((correctAnswer == null || correctAnswer.isEmpty()) &amp;&amp; quiz.getAnswerIndex() != null) {&#10;                List&lt;String&gt; options = quiz.getOptions();&#10;                int index = quiz.getAnswerIndex();&#10;                if (options != null &amp;&amp; index &gt;= 0 &amp;&amp; index &lt; options.size()) {&#10;                    correctAnswer = options.get(index);&#10;                    Log.d(TAG, &quot;Using answer from index &quot; + index + &quot;: &quot; + correctAnswer);&#10;                }&#10;            }&#10;&#10;            question.setCorrectAnswer(correctAnswer);&#10;            question.setExplanation(quiz.getExplanation());&#10;            questions.add(question);&#10;        }&#10;        return questions;&#10;    }&#10;&#10;    private List&lt;QuizQuestion&gt; convertGrammarExercises(List&lt;GrammarExercise&gt; exercises) {&#10;        List&lt;QuizQuestion&gt; questions = new ArrayList&lt;&gt;();&#10;        for (int i = 0; i &lt; exercises.size(); i++) {&#10;            GrammarExercise exercise = exercises.get(i);&#10;            Log.d(TAG, &quot;=== GrammarExercise #&quot; + (i + 1) + &quot; ===&quot;);&#10;            Log.d(TAG, &quot;Question: &quot; + exercise.getQuestion());&#10;            Log.d(TAG, &quot;ExerciseType: &quot; + exercise.getExerciseType());&#10;            Log.d(TAG, &quot;Correct Answer: &quot; + exercise.getCorrectAnswer());&#10;            Log.d(TAG, &quot;Answer Index: &quot; + exercise.getAnswerIndex());&#10;            Log.d(TAG, &quot;Options: &quot; + exercise.getOptions());&#10;&#10;            QuizQuestion question = new QuizQuestion();&#10;            question.setQuestion(exercise.getQuestion());&#10;            question.setQuestionType(exercise.getExerciseType());&#10;&#10;            // Handle options based on exercise type&#10;            List&lt;String&gt; options = exercise.getOptions();&#10;            String exerciseType = exercise.getExerciseType();&#10;&#10;            // For true_false type, generate True/False options if not provided&#10;            if (&quot;true_false&quot;.equalsIgnoreCase(exerciseType) &amp;&amp; (options == null || options.isEmpty())) {&#10;                options = new ArrayList&lt;&gt;();&#10;                options.add(&quot;True&quot;);&#10;                options.add(&quot;False&quot;);&#10;                Log.d(TAG, &quot;Generated True/False options for true_false type&quot;);&#10;            }&#10;&#10;            question.setOptions(options);&#10;&#10;            // Determine correct answer - use correctAnswer if available, otherwise use answerIndex&#10;            String correctAnswer = exercise.getCorrectAnswer();&#10;            if ((correctAnswer == null || correctAnswer.isEmpty()) &amp;&amp; exercise.getAnswerIndex() != null) {&#10;                int index = exercise.getAnswerIndex();&#10;                if (options != null &amp;&amp; index &gt;= 0 &amp;&amp; index &lt; options.size()) {&#10;                    correctAnswer = options.get(index);&#10;                    Log.d(TAG, &quot;Using answer from index &quot; + index + &quot;: &quot; + correctAnswer);&#10;                }&#10;            }&#10;&#10;            // Normalize true/false answers to match options&#10;            if (&quot;true_false&quot;.equalsIgnoreCase(exerciseType) &amp;&amp; correctAnswer != null) {&#10;                if (&quot;true&quot;.equalsIgnoreCase(correctAnswer)) {&#10;                    correctAnswer = &quot;True&quot;;&#10;                } else if (&quot;false&quot;.equalsIgnoreCase(correctAnswer)) {&#10;                    correctAnswer = &quot;False&quot;;&#10;                }&#10;            }&#10;&#10;            question.setCorrectAnswer(correctAnswer);&#10;            question.setExplanation(exercise.getExplanation());&#10;            questions.add(question);&#10;        }&#10;        return questions;&#10;    }&#10;&#10;    private void displayQuestion() {&#10;        if (quizQuestions == null || currentQuestionIndex &gt;= quizQuestions.size()) {&#10;            showQuizComplete();&#10;            return;&#10;        }&#10;&#10;        QuizQuestion currentQuestion = quizQuestions.get(currentQuestionIndex);&#10;&#10;        // Update progress&#10;        tvQuestionNumber.setText(&quot;Question &quot; + (currentQuestionIndex + 1) + &quot; of &quot; + quizQuestions.size());&#10;        tvScore.setText(&quot;Score: &quot; + score + &quot;/&quot; + (currentQuestionIndex));&#10;        horizontalProgress.setMax(quizQuestions.size());&#10;        horizontalProgress.setProgress(currentQuestionIndex + 1);&#10;&#10;        // Display question&#10;        tvQuestion.setText(currentQuestion.getQuestion());&#10;&#10;        // Display question type&#10;        String questionType = currentQuestion.getQuestionType();&#10;        if (questionType != null &amp;&amp; !questionType.isEmpty()) {&#10;            tvQuestionType.setText(&quot;Type: &quot; + questionType.replace(&quot;_&quot;, &quot; &quot;).toUpperCase());&#10;            tvQuestionType.setVisibility(View.VISIBLE);&#10;        } else {&#10;            tvQuestionType.setVisibility(View.GONE);&#10;        }&#10;&#10;        // Clear previous options&#10;        radioGroup.removeAllViews();&#10;        radioGroup.clearCheck();&#10;&#10;        // Add new options&#10;        if (currentQuestion.getOptions() != null &amp;&amp; !currentQuestion.getOptions().isEmpty()) {&#10;            for (String option : currentQuestion.getOptions()) {&#10;                RadioButton radioButton = new RadioButton(this);&#10;                radioButton.setText(option);&#10;                radioButton.setTextSize(16);&#10;                radioButton.setPadding(24, 24, 24, 24);&#10;                radioButton.setTextColor(getResources().getColor(R.color.text_primary));&#10;                radioGroup.addView(radioButton);&#10;            }&#10;        }&#10;&#10;        // Reset UI state&#10;        cardExplanation.setVisibility(View.GONE);&#10;        btnSubmit.setEnabled(true);&#10;        btnSubmit.setVisibility(View.VISIBLE);&#10;        btnNext.setVisibility(View.GONE);&#10;        btnFinish.setVisibility(View.GONE);&#10;    }&#10;&#10;    private void checkAnswer() {&#10;        int selectedId = radioGroup.getCheckedRadioButtonId();&#10;        if (selectedId == -1) {&#10;            Toast.makeText(this, &quot;Please select an answer&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;&#10;        RadioButton selectedButton = findViewById(selectedId);&#10;        String selectedAnswer = selectedButton.getText().toString();&#10;&#10;        QuizQuestion currentQuestion = quizQuestions.get(currentQuestionIndex);&#10;        String correctAnswer = currentQuestion.getCorrectAnswer();&#10;        Log.d(TAG, &quot;Checking answer - Selected: &quot; + selectedAnswer + &quot;, Correct: &quot; + correctAnswer);&#10;&#10;        // If correctAnswer is null, we can't validate - show error&#10;        if (correctAnswer == null || correctAnswer.isEmpty()) {&#10;            Log.e(TAG, &quot;ERROR: correctAnswer is null or empty for question: &quot; + currentQuestion.getQuestion());&#10;            Toast.makeText(this, &quot;Error: Quiz data incomplete. Cannot validate answer.&quot;, Toast.LENGTH_LONG).show();&#10;            // Still allow progression&#10;            btnSubmit.setEnabled(false);&#10;            btnSubmit.setVisibility(View.GONE);&#10;            if (currentQuestionIndex &lt; quizQuestions.size() - 1) {&#10;                btnNext.setVisibility(View.VISIBLE);&#10;            } else {&#10;                btnFinish.setVisibility(View.VISIBLE);&#10;            }&#10;            return;&#10;        }&#10;&#10;        boolean isCorrect = selectedAnswer.equals(correctAnswer);&#10;&#10;        // Update score&#10;        if (isCorrect) {&#10;            correctAnswers++;&#10;            score += 10; // 10 points per correct answer&#10;            selectedButton.setTextColor(getResources().getColor(R.color.beginner_color));&#10;            Toast.makeText(this, &quot;✓ Correct!&quot;, Toast.LENGTH_SHORT).show();&#10;        } else {&#10;            selectedButton.setTextColor(getResources().getColor(R.color.advanced_color));&#10;&#10;            // Highlight correct answer&#10;            for (int i = 0; i &lt; radioGroup.getChildCount(); i++) {&#10;                RadioButton rb = (RadioButton) radioGroup.getChildAt(i);&#10;                if (rb.getText().toString().equals(correctAnswer)) {&#10;                    rb.setTextColor(getResources().getColor(R.color.beginner_color));&#10;                    break;&#10;                }&#10;            }&#10;&#10;            Toast.makeText(this, &quot;✗ Wrong! Correct: &quot; + (correctAnswer != null ? correctAnswer : &quot;N/A&quot;),&#10;                         Toast.LENGTH_LONG).show();&#10;        }&#10;&#10;        // Update score display&#10;        tvScore.setText(&quot;Score: &quot; + score + &quot;/&quot; + ((currentQuestionIndex + 1) * 10));&#10;&#10;        // Show explanation if available&#10;        if (currentQuestion.getExplanation() != null &amp;&amp; !currentQuestion.getExplanation().isEmpty()) {&#10;            tvExplanation.setText(&quot; &quot; + currentQuestion.getExplanation());&#10;            cardExplanation.setVisibility(View.VISIBLE);&#10;        }&#10;&#10;        // Disable answer selection&#10;        btnSubmit.setEnabled(false);&#10;        btnSubmit.setVisibility(View.GONE);&#10;&#10;        // Show appropriate next button&#10;        if (currentQuestionIndex &lt; quizQuestions.size() - 1) {&#10;            btnNext.setVisibility(View.VISIBLE);&#10;        } else {&#10;            btnFinish.setVisibility(View.VISIBLE);&#10;        }&#10;    }&#10;&#10;    private void loadNextQuestion() {&#10;        currentQuestionIndex++;&#10;        displayQuestion();&#10;    }&#10;&#10;    private void showQuizComplete() {&#10;        // This shouldn't be called directly, use showFinalResults instead&#10;        showFinalResults();&#10;    }&#10;&#10;    private void showFinalResults() {&#10;        int totalQuestions = quizQuestions.size();&#10;        double percentage = (double) correctAnswers / totalQuestions * 100;&#10;        int maxScore = totalQuestions * 10;&#10;&#10;        // Determine performance level&#10;        String performanceLevel;&#10;        int performanceColor;&#10;        if (percentage &gt;= 80) {&#10;            performanceLevel = &quot;Excellent!&quot;;&#10;            performanceColor = getResources().getColor(R.color.beginner_color);&#10;        } else if (percentage &gt;= 60) {&#10;            performanceLevel = &quot;Good!&quot;;&#10;            performanceColor = getResources().getColor(R.color.intermediate_color);&#10;        } else {&#10;            performanceLevel = &quot;Keep Practicing!&quot;;&#10;            performanceColor = getResources().getColor(R.color.advanced_color);&#10;        }&#10;&#10;        // Create result dialog&#10;        AlertDialog.Builder builder = new AlertDialog.Builder(this);&#10;        builder.setTitle(&quot; Quiz Completed!&quot;);&#10;&#10;        String message = String.format(&#10;            &quot;Performance: %s\n\n&quot; +&#10;            &quot;Correct Answers: %d/%d\n&quot; +&#10;            &quot;Score: %d/%d\n&quot; +&#10;            &quot;Percentage: %.1f%%&quot;,&#10;            performanceLevel, correctAnswers, totalQuestions, score, maxScore, percentage&#10;        );&#10;&#10;        builder.setMessage(message);&#10;        builder.setCancelable(false);&#10;&#10;        builder.setPositiveButton(&quot;Review Answers&quot;, (dialog, which) -&gt; {&#10;            // Reset to first question for review&#10;            currentQuestionIndex = 0;&#10;            displayQuestion();&#10;            btnSubmit.setVisibility(View.GONE);&#10;            btnNext.setVisibility(View.VISIBLE);&#10;        });&#10;&#10;        builder.setNegativeButton(&quot;Finish&quot;, (dialog, which) -&gt; {&#10;            finish();&#10;        });&#10;&#10;        AlertDialog dialog = builder.create();&#10;        dialog.show();&#10;&#10;        // Color the message text&#10;        TextView messageView = dialog.findViewById(android.R.id.message);&#10;        if (messageView != null) {&#10;            messageView.setTextColor(performanceColor);&#10;        }&#10;    }&#10;&#10;    private void showError(String message) {&#10;        Toast.makeText(this, message, Toast.LENGTH_LONG).show();&#10;        Log.e(TAG, message);&#10;    }&#10;&#10;    @Override&#10;    public boolean onSupportNavigateUp() {&#10;        onBackPressed();&#10;        return true;&#10;    }&#10;&#10;    @Override&#10;    public void onBackPressed() {&#10;        // Show confirmation dialog if quiz is in progress&#10;        if (currentQuestionIndex &gt; 0 &amp;&amp; currentQuestionIndex &lt; quizQuestions.size()) {&#10;            new AlertDialog.Builder(this)&#10;                .setTitle(&quot;Exit Quiz?&quot;)&#10;                .setMessage(&quot;Your progress will be lost. Are you sure you want to exit?&quot;)&#10;                .setPositiveButton(&quot;Yes&quot;, (dialog, which) -&gt; {&#10;                    super.onBackPressed();&#10;                })&#10;                .setNegativeButton(&quot;No&quot;, null)&#10;                .show();&#10;        } else {&#10;            super.onBackPressed();&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Inner class to represent a unified quiz question&#10;     */&#10;    private static class QuizQuestion {&#10;        private String question;&#10;        private String questionType;&#10;        private List&lt;String&gt; options;&#10;        private String correctAnswer;&#10;        private String explanation;&#10;&#10;        public String getQuestion() {&#10;            return question;&#10;        }&#10;&#10;        public void setQuestion(String question) {&#10;            this.question = question;&#10;        }&#10;&#10;        public String getQuestionType() {&#10;            return questionType;&#10;        }&#10;&#10;        public void setQuestionType(String questionType) {&#10;            this.questionType = questionType;&#10;        }&#10;&#10;        public List&lt;String&gt; getOptions() {&#10;            return options;&#10;        }&#10;&#10;        public void setOptions(List&lt;String&gt; options) {&#10;            this.options = options;&#10;        }&#10;&#10;        public String getCorrectAnswer() {&#10;            return correctAnswer;&#10;        }&#10;&#10;        public void setCorrectAnswer(String correctAnswer) {&#10;            this.correctAnswer = correctAnswer;&#10;        }&#10;&#10;        public String getExplanation() {&#10;            return explanation;&#10;        }&#10;&#10;        public void setExplanation(String explanation) {&#10;            this.explanation = explanation;&#10;        }&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.ptithcm.lexigo.activities;&#10;&#10;import android.content.Intent;&#10;import android.graphics.Color;&#10;import android.os.Bundle;&#10;import android.util.Log;&#10;import android.view.View;&#10;import android.widget.Button;&#10;import android.widget.LinearLayout;&#10;import android.widget.ProgressBar;&#10;import android.widget.RadioButton;&#10;import android.widget.RadioGroup;&#10;import android.widget.TextView;&#10;import android.widget.Toast;&#10;&#10;import androidx.appcompat.app.AlertDialog;&#10;import androidx.appcompat.app.AppCompatActivity;&#10;import androidx.cardview.widget.CardView;&#10;&#10;import com.ptithcm.lexigo.R;&#10;import com.ptithcm.lexigo.api.ApiClient;&#10;import com.ptithcm.lexigo.api.models.GrammarExercise;&#10;import com.ptithcm.lexigo.api.models.VocabQuiz;&#10;import com.ptithcm.lexigo.api.responses.ApiResponse;&#10;import com.ptithcm.lexigo.api.services.LexiGoApiService;&#10;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;/**&#10; * Unified Quiz Activity for both Vocabulary and Grammar quizzes&#10; * Supports multiple question types: multiple_choice, fill_in_blank, etc.&#10; */&#10;public class QuizActivity extends AppCompatActivity {&#10;    private static final String TAG = &quot;QuizActivity&quot;;&#10;&#10;    // Intent extras constants&#10;    public static final String EXTRA_QUIZ_TYPE = &quot;quiz_type&quot;;&#10;    public static final String EXTRA_TOPIC_ID = &quot;topic_id&quot;;&#10;    public static final String EXTRA_LESSON_ID = &quot;lesson_id&quot;;&#10;    public static final String EXTRA_LEVEL = &quot;level&quot;;&#10;    public static final String EXTRA_TITLE = &quot;title&quot;;&#10;&#10;    public static final String QUIZ_TYPE_VOCAB = &quot;vocab&quot;;&#10;    public static final String QUIZ_TYPE_GRAMMAR = &quot;grammar&quot;;&#10;&#10;    // UI Components&#10;    private CardView cardProgress;&#10;    private TextView tvQuestionNumber, tvScore, tvTimer;&#10;    private ProgressBar horizontalProgress, loadingProgress;&#10;    private CardView cardQuestion;&#10;    private TextView tvQuestion, tvQuestionType;&#10;    private RadioGroup radioGroup;&#10;    private com.google.android.material.textfield.TextInputLayout inputLayoutAnswer;&#10;    private com.google.android.material.textfield.TextInputEditText etAnswer;&#10;    private CardView cardExplanation;&#10;    private TextView tvExplanation;&#10;    private LinearLayout buttonLayout;&#10;    private Button btnSubmit, btnNext, btnFinish;&#10;&#10;    // Data&#10;    private LexiGoApiService apiService;&#10;    private List&lt;QuizQuestion&gt; quizQuestions;&#10;    private int currentQuestionIndex = 0;&#10;    private int score = 0;&#10;    private int correctAnswers = 0;&#10;&#10;    private String quizType;&#10;    private String topicId;&#10;    private String lessonId;&#10;    private String level;&#10;    private String quizTitle;&#10;&#10;    @Override&#10;    protected void onCreate(Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        setContentView(R.layout.activity_quiz);&#10;&#10;        // Get data from intent&#10;        Intent intent = getIntent();&#10;        if (intent != null) {&#10;            quizType = intent.getStringExtra(EXTRA_QUIZ_TYPE);&#10;            topicId = intent.getStringExtra(EXTRA_TOPIC_ID);&#10;            lessonId = intent.getStringExtra(EXTRA_LESSON_ID);&#10;            level = intent.getStringExtra(EXTRA_LEVEL);&#10;            quizTitle = intent.getStringExtra(EXTRA_TITLE);&#10;        }&#10;&#10;        // Set title&#10;        if (getSupportActionBar() != null) {&#10;            getSupportActionBar().setTitle(quizTitle != null ? quizTitle + &quot; - Quiz&quot; : &quot;Quiz&quot;);&#10;            getSupportActionBar().setDisplayHomeAsUpEnabled(true);&#10;        }&#10;&#10;        initViews();&#10;        loadQuiz();&#10;    }&#10;&#10;    private void initViews() {&#10;        // Progress card&#10;        cardProgress = findViewById(R.id.card_progress);&#10;        tvQuestionNumber = findViewById(R.id.tv_question_number);&#10;        tvScore = findViewById(R.id.tv_score);&#10;        tvTimer = findViewById(R.id.tv_timer);&#10;        horizontalProgress = findViewById(R.id.horizontal_progress);&#10;&#10;        // Loading&#10;        loadingProgress = findViewById(R.id.loading_progress);&#10;&#10;        // Question card&#10;        cardQuestion = findViewById(R.id.card_question);&#10;        tvQuestion = findViewById(R.id.tv_question);&#10;        tvQuestionType = findViewById(R.id.tv_question_type);&#10;        radioGroup = findViewById(R.id.radio_group);&#10;        inputLayoutAnswer = findViewById(R.id.input_layout_answer);&#10;        etAnswer = findViewById(R.id.et_answer);&#10;&#10;        // Explanation card&#10;        cardExplanation = findViewById(R.id.card_explanation);&#10;        tvExplanation = findViewById(R.id.tv_explanation);&#10;&#10;        // Buttons&#10;        buttonLayout = findViewById(R.id.button_layout);&#10;        btnSubmit = findViewById(R.id.btn_submit);&#10;        btnNext = findViewById(R.id.btn_next);&#10;        btnFinish = findViewById(R.id.btn_finish);&#10;&#10;        // Initialize API service&#10;        apiService = ApiClient.getInstance(this).getApiService();&#10;&#10;        // Set click listeners&#10;        btnSubmit.setOnClickListener(v -&gt; checkAnswer());&#10;        btnNext.setOnClickListener(v -&gt; loadNextQuestion());&#10;        btnFinish.setOnClickListener(v -&gt; showFinalResults());&#10;&#10;        // Initially hide explanation&#10;        cardExplanation.setVisibility(View.GONE);&#10;    }&#10;&#10;    private void loadQuiz() {&#10;        if (quizType == null) {&#10;            showError(&quot;Quiz type is required&quot;);&#10;            finish();&#10;            return;&#10;        }&#10;&#10;        loadingProgress.setVisibility(View.VISIBLE);&#10;        cardQuestion.setVisibility(View.GONE);&#10;&#10;        if (QUIZ_TYPE_VOCAB.equals(quizType)) {&#10;            loadVocabQuiz();&#10;        } else if (QUIZ_TYPE_GRAMMAR.equals(quizType)) {&#10;            loadGrammarQuiz();&#10;        } else {&#10;            showError(&quot;Invalid quiz type&quot;);&#10;            finish();&#10;        }&#10;    }&#10;&#10;    private void loadVocabQuiz() {&#10;        if (topicId == null) {&#10;            showError(&quot;Topic ID is required for vocab quiz&quot;);&#10;            finish();&#10;            return;&#10;        }&#10;&#10;        Call&lt;ApiResponse&lt;List&lt;VocabQuiz&gt;&gt;&gt; call = apiService.getVocabQuizzes(topicId, level);&#10;        call.enqueue(new Callback&lt;ApiResponse&lt;List&lt;VocabQuiz&gt;&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;ApiResponse&lt;List&lt;VocabQuiz&gt;&gt;&gt; call,&#10;                                 Response&lt;ApiResponse&lt;List&lt;VocabQuiz&gt;&gt;&gt; response) {&#10;                loadingProgress.setVisibility(View.GONE);&#10;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    ApiResponse&lt;List&lt;VocabQuiz&gt;&gt; apiResponse = response.body();&#10;                    if (apiResponse.isSuccess() &amp;&amp; apiResponse.getData() != null) {&#10;                        List&lt;VocabQuiz&gt; vocabQuizzes = apiResponse.getData();&#10;                        Log.d(TAG, &quot;Received &quot; + vocabQuizzes.size() + &quot; vocab quizzes&quot;);&#10;                        quizQuestions = convertVocabQuizzes(vocabQuizzes);&#10;&#10;                        if (!quizQuestions.isEmpty()) {&#10;                            cardQuestion.setVisibility(View.VISIBLE);&#10;                            displayQuestion();&#10;                        } else {&#10;                            showError(&quot;No quiz questions available&quot;);&#10;                        }&#10;                    } else {&#10;                        showError(&quot;Failed to load quiz: &quot; + apiResponse.getMessage());&#10;                    }&#10;                } else {&#10;                    showError(&quot;Failed to load quiz&quot;);&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;ApiResponse&lt;List&lt;VocabQuiz&gt;&gt;&gt; call, Throwable t) {&#10;                loadingProgress.setVisibility(View.GONE);&#10;                Log.e(TAG, &quot;Error loading vocab quiz&quot;, t);&#10;                showError(&quot;Network error: &quot; + t.getMessage());&#10;            }&#10;        });&#10;    }&#10;&#10;    private void loadGrammarQuiz() {&#10;        if (lessonId == null) {&#10;            showError(&quot;Lesson ID is required for grammar quiz&quot;);&#10;            finish();&#10;            return;&#10;        }&#10;&#10;        Call&lt;ApiResponse&lt;List&lt;GrammarExercise&gt;&gt;&gt; call = apiService.getGrammarExercisesByGrammarId(lessonId);&#10;        call.enqueue(new Callback&lt;ApiResponse&lt;List&lt;GrammarExercise&gt;&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;ApiResponse&lt;List&lt;GrammarExercise&gt;&gt;&gt; call,&#10;                                 Response&lt;ApiResponse&lt;List&lt;GrammarExercise&gt;&gt;&gt; response) {&#10;                loadingProgress.setVisibility(View.GONE);&#10;&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    ApiResponse&lt;List&lt;GrammarExercise&gt;&gt; apiResponse = response.body();&#10;                    if (apiResponse.isSuccess() &amp;&amp; apiResponse.getData() != null) {&#10;                        List&lt;GrammarExercise&gt; grammarExercises = apiResponse.getData();&#10;                        quizQuestions = convertGrammarExercises(grammarExercises);&#10;&#10;                        if (!quizQuestions.isEmpty()) {&#10;                            cardQuestion.setVisibility(View.VISIBLE);&#10;                            displayQuestion();&#10;                        } else {&#10;                            showError(&quot;No exercises available&quot;);&#10;                        }&#10;                    } else {&#10;                        showError(&quot;Failed to load exercises: &quot; + apiResponse.getMessage());&#10;                    }&#10;                } else {&#10;                    showError(&quot;Failed to load exercises&quot;);&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;ApiResponse&lt;List&lt;GrammarExercise&gt;&gt;&gt; call, Throwable t) {&#10;                loadingProgress.setVisibility(View.GONE);&#10;                Log.e(TAG, &quot;Error loading grammar exercises&quot;, t);&#10;                showError(&quot;Network error: &quot; + t.getMessage());&#10;            }&#10;        });&#10;    }&#10;&#10;    private List&lt;QuizQuestion&gt; convertVocabQuizzes(List&lt;VocabQuiz&gt; vocabQuizzes) {&#10;        List&lt;QuizQuestion&gt; questions = new ArrayList&lt;&gt;();&#10;        for (int i = 0; i &lt; vocabQuizzes.size(); i++) {&#10;            VocabQuiz quiz = vocabQuizzes.get(i);&#10;            Log.d(TAG, &quot;=== VocabQuiz #&quot; + (i + 1) + &quot; ===&quot;);&#10;            Log.d(TAG, &quot;Question: &quot; + quiz.getQuestion());&#10;            Log.d(TAG, &quot;QuestionType: &quot; + quiz.getQuestionType());&#10;            Log.d(TAG, &quot;Correct Answer: &quot; + quiz.getCorrectAnswer());&#10;            Log.d(TAG, &quot;Answer Index: &quot; + quiz.getAnswerIndex());&#10;            Log.d(TAG, &quot;Options: &quot; + quiz.getOptions());&#10;            Log.d(TAG, &quot;Explanation: &quot; + quiz.getExplanation());&#10;&#10;            QuizQuestion question = new QuizQuestion();&#10;            question.setQuestion(quiz.getQuestion());&#10;            question.setQuestionType(quiz.getQuestionType());&#10;            question.setOptions(quiz.getOptions());&#10;&#10;            // Determine correct answer - use correctAnswer if available, otherwise use answerIndex&#10;            String correctAnswer = quiz.getCorrectAnswer();&#10;            if ((correctAnswer == null || correctAnswer.isEmpty()) &amp;&amp; quiz.getAnswerIndex() != null) {&#10;                List&lt;String&gt; options = quiz.getOptions();&#10;                int index = quiz.getAnswerIndex();&#10;                if (options != null &amp;&amp; index &gt;= 0 &amp;&amp; index &lt; options.size()) {&#10;                    correctAnswer = options.get(index);&#10;                    Log.d(TAG, &quot;Using answer from index &quot; + index + &quot;: &quot; + correctAnswer);&#10;                }&#10;            }&#10;&#10;            question.setCorrectAnswer(correctAnswer);&#10;            question.setExplanation(quiz.getExplanation());&#10;            questions.add(question);&#10;        }&#10;        return questions;&#10;    }&#10;&#10;    private List&lt;QuizQuestion&gt; convertGrammarExercises(List&lt;GrammarExercise&gt; exercises) {&#10;        List&lt;QuizQuestion&gt; questions = new ArrayList&lt;&gt;();&#10;        for (int i = 0; i &lt; exercises.size(); i++) {&#10;            GrammarExercise exercise = exercises.get(i);&#10;            Log.d(TAG, &quot;=== GrammarExercise #&quot; + (i + 1) + &quot; ===&quot;);&#10;            Log.d(TAG, &quot;Question: &quot; + exercise.getQuestion());&#10;            Log.d(TAG, &quot;ExerciseType: &quot; + exercise.getExerciseType());&#10;            Log.d(TAG, &quot;Correct Answer: &quot; + exercise.getCorrectAnswer());&#10;            Log.d(TAG, &quot;Answer Index: &quot; + exercise.getAnswerIndex());&#10;            Log.d(TAG, &quot;Options: &quot; + exercise.getOptions());&#10;&#10;            QuizQuestion question = new QuizQuestion();&#10;            question.setQuestion(exercise.getQuestion());&#10;            question.setQuestionType(exercise.getExerciseType());&#10;&#10;            // Handle options based on exercise type&#10;            List&lt;String&gt; options = exercise.getOptions();&#10;            String exerciseType = exercise.getExerciseType();&#10;&#10;            // For true_false type, generate True/False options if not provided&#10;            if (&quot;true_false&quot;.equalsIgnoreCase(exerciseType) &amp;&amp; (options == null || options.isEmpty())) {&#10;                options = new ArrayList&lt;&gt;();&#10;                options.add(&quot;True&quot;);&#10;                options.add(&quot;False&quot;);&#10;                Log.d(TAG, &quot;Generated True/False options for true_false type&quot;);&#10;            }&#10;&#10;            question.setOptions(options);&#10;&#10;            // Determine correct answer - use correctAnswer if available, otherwise use answerIndex&#10;            String correctAnswer = exercise.getCorrectAnswer();&#10;            if ((correctAnswer == null || correctAnswer.isEmpty()) &amp;&amp; exercise.getAnswerIndex() != null) {&#10;                int index = exercise.getAnswerIndex();&#10;                if (options != null &amp;&amp; index &gt;= 0 &amp;&amp; index &lt; options.size()) {&#10;                    correctAnswer = options.get(index);&#10;                    Log.d(TAG, &quot;Using answer from index &quot; + index + &quot;: &quot; + correctAnswer);&#10;                }&#10;            }&#10;&#10;            // Normalize true/false answers to match options&#10;            if (&quot;true_false&quot;.equalsIgnoreCase(exerciseType) &amp;&amp; correctAnswer != null) {&#10;                if (&quot;true&quot;.equalsIgnoreCase(correctAnswer)) {&#10;                    correctAnswer = &quot;True&quot;;&#10;                } else if (&quot;false&quot;.equalsIgnoreCase(correctAnswer)) {&#10;                    correctAnswer = &quot;False&quot;;&#10;                }&#10;            }&#10;&#10;            question.setCorrectAnswer(correctAnswer);&#10;            question.setExplanation(exercise.getExplanation());&#10;            questions.add(question);&#10;        }&#10;        return questions;&#10;    }&#10;&#10;    private void displayQuestion() {&#10;        if (quizQuestions == null || currentQuestionIndex &gt;= quizQuestions.size()) {&#10;            showQuizComplete();&#10;            return;&#10;        }&#10;&#10;        QuizQuestion currentQuestion = quizQuestions.get(currentQuestionIndex);&#10;&#10;        // Update progress&#10;        tvQuestionNumber.setText(&quot;Question &quot; + (currentQuestionIndex + 1) + &quot; of &quot; + quizQuestions.size());&#10;        tvScore.setText(&quot;Score: &quot; + score + &quot;/&quot; + (currentQuestionIndex));&#10;        horizontalProgress.setMax(quizQuestions.size());&#10;        horizontalProgress.setProgress(currentQuestionIndex + 1);&#10;&#10;        // Display question&#10;        tvQuestion.setText(currentQuestion.getQuestion());&#10;&#10;        // Display question type&#10;        String questionType = currentQuestion.getQuestionType();&#10;        if (questionType != null &amp;&amp; !questionType.isEmpty()) {&#10;            tvQuestionType.setText(&quot;Type: &quot; + questionType.replace(&quot;_&quot;, &quot; &quot;).toUpperCase());&#10;            tvQuestionType.setVisibility(View.VISIBLE);&#10;        } else {&#10;            tvQuestionType.setVisibility(View.GONE);&#10;        }&#10;&#10;        // Check if this is a fill_blank question&#10;        boolean isFillBlank = &quot;fill_blank&quot;.equalsIgnoreCase(questionType);&#10;&#10;        // Clear previous options&#10;        radioGroup.removeAllViews();&#10;        radioGroup.clearCheck();&#10;&#10;        // Clear previous input&#10;        if (etAnswer != null) {&#10;            etAnswer.setText(&quot;&quot;);&#10;        }&#10;&#10;        if (isFillBlank) {&#10;            // Show input field for fill_blank type&#10;            inputLayoutAnswer.setVisibility(View.VISIBLE);&#10;            radioGroup.setVisibility(View.GONE);&#10;        } else {&#10;            // Show radio buttons for other types&#10;            inputLayoutAnswer.setVisibility(View.GONE);&#10;            radioGroup.setVisibility(View.VISIBLE);&#10;&#10;            // Add new options&#10;            if (currentQuestion.getOptions() != null &amp;&amp; !currentQuestion.getOptions().isEmpty()) {&#10;                for (String option : currentQuestion.getOptions()) {&#10;                    RadioButton radioButton = new RadioButton(this);&#10;                    radioButton.setText(option);&#10;                    radioButton.setTextSize(16);&#10;                    radioButton.setPadding(24, 24, 24, 24);&#10;                    radioButton.setTextColor(getResources().getColor(R.color.text_primary));&#10;                    radioGroup.addView(radioButton);&#10;                }&#10;            }&#10;        }&#10;&#10;        // Reset UI state&#10;        cardExplanation.setVisibility(View.GONE);&#10;        btnSubmit.setEnabled(true);&#10;        btnSubmit.setVisibility(View.VISIBLE);&#10;        btnNext.setVisibility(View.GONE);&#10;        btnFinish.setVisibility(View.GONE);&#10;        &#10;        // Re-enable input controls&#10;        radioGroup.setEnabled(true);&#10;        if (etAnswer != null) {&#10;            etAnswer.setEnabled(true);&#10;        }&#10;        if (inputLayoutAnswer != null) {&#10;            inputLayoutAnswer.setError(null);&#10;            inputLayoutAnswer.setBoxStrokeColor(getResources().getColor(R.color.primary));&#10;        }&#10;    }&#10;&#10;    private void checkAnswer() {&#10;        QuizQuestion currentQuestion = quizQuestions.get(currentQuestionIndex);&#10;        String questionType = currentQuestion.getQuestionType();&#10;        String selectedAnswer = null;&#10;&#10;        // Get answer based on question type&#10;        boolean isFillBlank = &quot;fill_blank&quot;.equalsIgnoreCase(questionType);&#10;&#10;        if (isFillBlank) {&#10;            // Get answer from EditText&#10;            if (etAnswer != null &amp;&amp; etAnswer.getText() != null) {&#10;                selectedAnswer = etAnswer.getText().toString().trim();&#10;            }&#10;&#10;            if (selectedAnswer == null || selectedAnswer.isEmpty()) {&#10;                Toast.makeText(this, &quot;Please enter an answer&quot;, Toast.LENGTH_SHORT).show();&#10;                return;&#10;            }&#10;        } else {&#10;            // Get answer from RadioButton&#10;            int selectedId = radioGroup.getCheckedRadioButtonId();&#10;            if (selectedId == -1) {&#10;                Toast.makeText(this, &quot;Please select an answer&quot;, Toast.LENGTH_SHORT).show();&#10;                return;&#10;            }&#10;&#10;            RadioButton selectedButton = findViewById(selectedId);&#10;            selectedAnswer = selectedButton.getText().toString();&#10;        }&#10;&#10;        String correctAnswer = currentQuestion.getCorrectAnswer();&#10;        Log.d(TAG, &quot;Checking answer - Selected: &quot; + selectedAnswer + &quot;, Correct: &quot; + correctAnswer);&#10;&#10;        // If correctAnswer is null, we can't validate - show error&#10;        if (correctAnswer == null || correctAnswer.isEmpty()) {&#10;            Log.e(TAG, &quot;ERROR: correctAnswer is null or empty for question: &quot; + currentQuestion.getQuestion());&#10;            Toast.makeText(this, &quot;Error: Quiz data incomplete. Cannot validate answer.&quot;, Toast.LENGTH_LONG).show();&#10;            // Still allow progression&#10;            btnSubmit.setEnabled(false);&#10;            btnSubmit.setVisibility(View.GONE);&#10;            if (currentQuestionIndex &lt; quizQuestions.size() - 1) {&#10;                btnNext.setVisibility(View.VISIBLE);&#10;            } else {&#10;                btnFinish.setVisibility(View.VISIBLE);&#10;            }&#10;            return;&#10;        }&#10;&#10;        // Check answer (case-insensitive for fill_blank)&#10;        boolean isCorrect;&#10;        if (isFillBlank) {&#10;            isCorrect = selectedAnswer.equalsIgnoreCase(correctAnswer);&#10;        } else {&#10;            isCorrect = selectedAnswer.equals(correctAnswer);&#10;        }&#10;&#10;        // Update score&#10;        if (isCorrect) {&#10;            correctAnswers++;&#10;            score += 10; // 10 points per correct answer&#10;            &#10;            if (isFillBlank) {&#10;                // Show success with green hint&#10;                inputLayoutAnswer.setBoxStrokeColor(getResources().getColor(R.color.beginner_color));&#10;                inputLayoutAnswer.setHintTextColor(android.content.res.ColorStateList.valueOf(getResources().getColor(R.color.beginner_color)));&#10;            } else {&#10;                // Highlight selected answer in green&#10;                int selectedId = radioGroup.getCheckedRadioButtonId();&#10;                RadioButton selectedButton = findViewById(selectedId);&#10;                if (selectedButton != null) {&#10;                    selectedButton.setTextColor(getResources().getColor(R.color.beginner_color));&#10;                }&#10;            }&#10;            &#10;            Toast.makeText(this, &quot;✓ Correct!&quot;, Toast.LENGTH_SHORT).show();&#10;        } else {&#10;            if (isFillBlank) {&#10;                // Show error with red hint and display correct answer&#10;                inputLayoutAnswer.setBoxStrokeColor(getResources().getColor(R.color.advanced_color));&#10;                inputLayoutAnswer.setHintTextColor(android.content.res.ColorStateList.valueOf(getResources().getColor(R.color.advanced_color)));&#10;                inputLayoutAnswer.setError(&quot;Correct answer: &quot; + correctAnswer);&#10;            } else {&#10;                // Highlight selected answer in red&#10;                int selectedId = radioGroup.getCheckedRadioButtonId();&#10;                RadioButton selectedButton = findViewById(selectedId);&#10;                if (selectedButton != null) {&#10;                    selectedButton.setTextColor(getResources().getColor(R.color.advanced_color));&#10;                }&#10;&#10;                // Highlight correct answer in green&#10;                for (int i = 0; i &lt; radioGroup.getChildCount(); i++) {&#10;                    RadioButton rb = (RadioButton) radioGroup.getChildAt(i);&#10;                    if (rb.getText().toString().equals(correctAnswer)) {&#10;                        rb.setTextColor(getResources().getColor(R.color.beginner_color));&#10;                        break;&#10;                    }&#10;                }&#10;            }&#10;&#10;            Toast.makeText(this, &quot;✗ Wrong! Correct: &quot; + (correctAnswer != null ? correctAnswer : &quot;N/A&quot;),&#10;                         Toast.LENGTH_LONG).show();&#10;        }&#10;&#10;        // Update score display&#10;        tvScore.setText(&quot;Score: &quot; + score + &quot;/&quot; + ((currentQuestionIndex + 1) * 10));&#10;&#10;        // Show explanation if available&#10;        if (currentQuestion.getExplanation() != null &amp;&amp; !currentQuestion.getExplanation().isEmpty()) {&#10;            tvExplanation.setText(&quot; &quot; + currentQuestion.getExplanation());&#10;            cardExplanation.setVisibility(View.VISIBLE);&#10;        }&#10;&#10;        // Disable answer selection&#10;        radioGroup.setEnabled(false);&#10;        for (int i = 0; i &lt; radioGroup.getChildCount(); i++) {&#10;            radioGroup.getChildAt(i).setEnabled(false);&#10;        }&#10;        if (etAnswer != null) {&#10;            etAnswer.setEnabled(false);&#10;        }&#10;        &#10;        btnSubmit.setEnabled(false);&#10;        btnSubmit.setVisibility(View.GONE);&#10;&#10;        // Show appropriate next button&#10;        if (currentQuestionIndex &lt; quizQuestions.size() - 1) {&#10;            btnNext.setVisibility(View.VISIBLE);&#10;        } else {&#10;            btnFinish.setVisibility(View.VISIBLE);&#10;        }&#10;    }&#10;&#10;    private void loadNextQuestion() {&#10;        currentQuestionIndex++;&#10;        displayQuestion();&#10;    }&#10;&#10;    private void showQuizComplete() {&#10;        // This shouldn't be called directly, use showFinalResults instead&#10;        showFinalResults();&#10;    }&#10;&#10;    private void showFinalResults() {&#10;        int totalQuestions = quizQuestions.size();&#10;        double percentage = (double) correctAnswers / totalQuestions * 100;&#10;        int maxScore = totalQuestions * 10;&#10;&#10;        // Determine performance level&#10;        String performanceLevel;&#10;        int performanceColor;&#10;        if (percentage &gt;= 80) {&#10;            performanceLevel = &quot;Excellent!&quot;;&#10;            performanceColor = getResources().getColor(R.color.beginner_color);&#10;        } else if (percentage &gt;= 60) {&#10;            performanceLevel = &quot;Good!&quot;;&#10;            performanceColor = getResources().getColor(R.color.intermediate_color);&#10;        } else {&#10;            performanceLevel = &quot;Keep Practicing!&quot;;&#10;            performanceColor = getResources().getColor(R.color.advanced_color);&#10;        }&#10;&#10;        // Create result dialog&#10;        AlertDialog.Builder builder = new AlertDialog.Builder(this);&#10;        builder.setTitle(&quot; Quiz Completed!&quot;);&#10;&#10;        String message = String.format(&#10;            &quot;Performance: %s\n\n&quot; +&#10;            &quot;Correct Answers: %d/%d\n&quot; +&#10;            &quot;Score: %d/%d\n&quot; +&#10;            &quot;Percentage: %.1f%%&quot;,&#10;            performanceLevel, correctAnswers, totalQuestions, score, maxScore, percentage&#10;        );&#10;&#10;        builder.setMessage(message);&#10;        builder.setCancelable(false);&#10;&#10;        builder.setPositiveButton(&quot;Review Answers&quot;, (dialog, which) -&gt; {&#10;            // Reset to first question for review&#10;            currentQuestionIndex = 0;&#10;            displayQuestion();&#10;            btnSubmit.setVisibility(View.GONE);&#10;            btnNext.setVisibility(View.VISIBLE);&#10;        });&#10;&#10;        builder.setNegativeButton(&quot;Finish&quot;, (dialog, which) -&gt; {&#10;            finish();&#10;        });&#10;&#10;        AlertDialog dialog = builder.create();&#10;        dialog.show();&#10;&#10;        // Color the message text&#10;        TextView messageView = dialog.findViewById(android.R.id.message);&#10;        if (messageView != null) {&#10;            messageView.setTextColor(performanceColor);&#10;        }&#10;    }&#10;&#10;    private void showError(String message) {&#10;        Toast.makeText(this, message, Toast.LENGTH_LONG).show();&#10;        Log.e(TAG, message);&#10;    }&#10;&#10;    @Override&#10;    public boolean onSupportNavigateUp() {&#10;        onBackPressed();&#10;        return true;&#10;    }&#10;&#10;    @Override&#10;    public void onBackPressed() {&#10;        // Show confirmation dialog if quiz is in progress&#10;        if (currentQuestionIndex &gt; 0 &amp;&amp; currentQuestionIndex &lt; quizQuestions.size()) {&#10;            new AlertDialog.Builder(this)&#10;                .setTitle(&quot;Exit Quiz?&quot;)&#10;                .setMessage(&quot;Your progress will be lost. Are you sure you want to exit?&quot;)&#10;                .setPositiveButton(&quot;Yes&quot;, (dialog, which) -&gt; {&#10;                    super.onBackPressed();&#10;                })&#10;                .setNegativeButton(&quot;No&quot;, null)&#10;                .show();&#10;        } else {&#10;            super.onBackPressed();&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Inner class to represent a unified quiz question&#10;     */&#10;    private static class QuizQuestion {&#10;        private String question;&#10;        private String questionType;&#10;        private List&lt;String&gt; options;&#10;        private String correctAnswer;&#10;        private String explanation;&#10;&#10;        public String getQuestion() {&#10;            return question;&#10;        }&#10;&#10;        public void setQuestion(String question) {&#10;            this.question = question;&#10;        }&#10;&#10;        public String getQuestionType() {&#10;            return questionType;&#10;        }&#10;&#10;        public void setQuestionType(String questionType) {&#10;            this.questionType = questionType;&#10;        }&#10;&#10;        public List&lt;String&gt; getOptions() {&#10;            return options;&#10;        }&#10;&#10;        public void setOptions(List&lt;String&gt; options) {&#10;            this.options = options;&#10;        }&#10;&#10;        public String getCorrectAnswer() {&#10;            return correctAnswer;&#10;        }&#10;&#10;        public void setCorrectAnswer(String correctAnswer) {&#10;            this.correctAnswer = correctAnswer;&#10;        }&#10;&#10;        public String getExplanation() {&#10;            return explanation;&#10;        }&#10;&#10;        public void setExplanation(String explanation) {&#10;            this.explanation = explanation;&#10;        }&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>